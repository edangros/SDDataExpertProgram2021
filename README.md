# JStudy
## DataStudy Java
자바 코드를 올렸습니다.

모듈 -> 각 날짜별 자료입니다. W2D2 = > 2주차 2번째 날입니다.

소스코드는 모듈/src/패키지 내부에 들어있습니다.

.vuerd.json파일의 경우 vscode의 ERD Editor 플러그인 설치시 ERD로 볼 수 있습니다.


<br>
## simplechat
* 자바 기반의 채팅 서버
* C# Winform 기반의 GUI 클라이언트
* MySQL DB서버
* C# 기반의 GUI Admin 클라이언트 (4GL)

위 4개 요소로 구성됩니다.
### 채팅 서버
자바 기반의 채팅 서버와 C# 클라이언트는 아래와 같은 절차를 통해 암호화 통신을 구현합니다.
1. 클라이언트는 서버에 RSA 공개키를 요청합니다. 서버는 RSA 공개키를 송신합니다.
2. 클라이언트는 랜덤 AES키를 제작, RSA 암호화시켜 송신합니다. 서버는 해당 AES키를 RSA 개인키로 암호화하여 클라이언트에게 다시 송신합니다.
3. 클라이언트는 수신받은 AES키를 복호화, 자신의 키와 대조하여 확인한 뒤, ok사인을 AES암호화하여 송신합니다.
4. 서버는 ok사인을 복호화하여 확인한 뒤 해당 암호키에 기반하여 인증 세션을 개설합니다.

인증 세션 개설 이후 아래 절차에 따라 클라이언트를 채팅에 접속시키고, 인증 통과시 채팅 세션을 개설합니다.
1. 인증 세션이 준비되었다는 신호가 수신되면, 클라이언트는 ID/PW를 서버로 송신합니다. 서버는 비밀번호를 해시화한 뒤, DB서버에 질의하여 ID/PW 일치여부를 확인합니다. 그 결과를 리턴합니다.
2. 클라이언트는 로그인이 완료되었다면 채널 입장을 요청하고 서버는 채팅 채널에 클라이언트를 연결시키고, 채팅 세션을 개설한 뒤 세션id와 세션 키를 클라이언트에게 전송합니다. 클라이언트는 해당 키를 저장해 세션을 기억합니다.
3. 채팅 채널은 세션의 메세지를 받았을 시 접속된 모든 세션에 전송을 요청합니다. 각 세션은 연결된 클라이언트에 암호화된 메세지를 전송하고, 클라이언트는 해당 키를 수신합니다.
4. 채팅 세션은 클라이언트의 메세지를 받았을 시 채팅 채널로 메세지를 전송하고, 채팅 채널로부터 메세지를 받았을 시 담당 클라이언트에게 메세지를 전송합니다.
5. 채팅 세션은 클라이언트로의 연결을 지속적으로 시도(keepalive)하며, 연결 실패시 클라이언트에서 재연결을 일정 시간 내에 요청하지 않는다면, 자신을 세션 풀로 반환합니다.
   
또한 채팅 채널은 데이터베이스로의 채팅 로그를 진행합니다.
1. 채팅 채널은 데이터베이스 송신 채널을 비동기로 시행합니다. 데이터베이스 송신 채널이 활성화 상태가 아니라면, 채팅 채널은 채팅 내용을 오래된 것부터 차례대로 송신 버퍼에 집어넣습니다.
2. 데이터베이스 송신 채널은 버퍼에 있는 내용을 차례대로 DB에 쿼리문을 통해 삽입합니다.