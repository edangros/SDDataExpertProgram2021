# Elasticsearch

우리는 셀 수 없이 많은 데이터를 다루고 있다. 데이터 분석가는 그러한 데이터 뭉치로부터 정보(information)을 뽑아내는 것을 주요 업무로 한다. 이를 elastic사에서는 [data in](https://www.elastic.co/guide/en/elasticsearch/reference/current/documents-indices.html), [information out](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-analyze.html)으로 표현하고 있다.

Elasticsearch는 [Elastic Stack](intro.md)의 심장과도 같은 엔진으로, 그 시작이기도 하다. Elasticsearch는 준-실시간 검색과 분석을, 모든 데이터에 대해서 수행할 수 있다. 그러한 데이터는 정형화되어있을수도, 그렇지 않을 수도 있으며, 숫자일수도 있고 기하학적 데이터일 수도 있다. Elasticsearch는 그러한 데이터를 효과적으로 저장하고 이후의 검색을 위해 색인을 매길 수도 있다. 

## 문서와 색인
Elasticsearch는 분산 문서 저장소이다. Elasticsearch는 SQL DB와 같이 행과 열로 된 테이블 대신 JSON 문서로 만들어진 복합적인 데이터 구조를 저장한다. 여러 노드로 구성된 클러스터에서 Elasticsearch를 구동한다면, 문서는 클러스터 전체로 분산되어 저장되고, 어느 노드에서건 즉시 조회할 수 있다.

문서는 저장될 때마다 색인이 붙여진다. 이를 통해 준-실시간(1초 미만)으로 검색될 수 있다. Elasticsearch는 이러한 역 색인(inverted index) 구조를 사용해 문자 검색을 매우 빠르게 해낸다. 역 색인 구조는 문서에 나타난 모든 단어를 저장하고 단어를 검색시 해당 단어를 포함한 모든 문서를 빠르게 출력할 수 있게 한다.

각 인덱스는 문서의 최적화된 집합으로 간주할 수 있고, 각 문서는 실질적인 데이터를 담고 있는 키(key)-값(value) 구조(즉 Map 구조)의 여러 필드로 구성되어 있다. 일반적으로, Elasticsearche는 모든 필드의 모든 데이터를 색인하고, 각 필드는 특정 목적의, 최적화된 데이터 구조를 가지고 있을 것이다.

Elasticsearche는 스키마가 존재하지 않다. 다시 말해, 모든 문서는 각 필터가 어떻게 생겼는지와 상관없이 색인된다. 동적 매핑(Dynamic mapping)을 활성화한다면 Elasticsearch는 자동으로 새로운 필드를 감지하고 색인에 추가한다. 이러한 모든 일은 자동으로 이루어지고, Elasticsearch는 심지어 각 필드의 자료형도 자동으로 확인한다.

또한, Elasticsearch에게 자료형을 미리 정의하고, 필드가 저장되고 색인되는 방식을 모두 사용자가 제어할 수도 있다. 이 경우에는 다음과 같은 일들을 할 수 있을 것이다.
* 완전한 텍스트 필드와 특정 문자열로만 구성된 필드를 구분할 수 있다. 예를 들어, '남''여'로만 입력되는 필드와 이름이 입력되는 필드를 다르게 취급할 수 있다.
* 특정 언어에 대한 문자 분석을 할 수 있다.
* 부분 일치 검사를 위해 필드 최적화를 할 수 있다.
* 커스텀된 날짜 포맷을 사용할 수 있다.
* 자동 감지되지 않는 데이터를 사용할 수 있다.(지리상의 특정 지점, 특정 형상 등)

상기한 내용을 볼 시 json기반 noSQL DB인 mongoDB와 큰 유사성이 보인다. (공통/차이점 추가 예정)

## 데이터의 검색
Elasticsearch는 REST API를 제공한다. 이를 통해서 구조화된 쿼리, 문자열 쿼리, 복합 쿼리를 하거나 이를 조합할 수 있다.

* 구조화된 쿼리는 SQL에서 시행하는 쿼리와 유사하다. 예를 들어 
'성별'과 '나이'를 '직원목록' 색인에서 찾아 '입사일' 기준으로 정렬하는 형태의 쿼리이다.
* 문자열 쿼리는 쿼리 문자열과 매칭되는 단어를 포함한 뒤 '연관도'에 따라 정렬한다.

또한 각종 지리/수학적 쿼리 또한 제공하고 있으며, 복합된 쿼리를 JSON 형태의 쿼리 언어(Query DSL)을 통해 실행하거나 SQL과 유사한 쿼리를 만들 수도 있다.

## 데이터의 분석
Elasticsearch는 데이터를 복합적으로 정리하고 중심 통계, 패턴, 트랜드 등을 분석할 수 있게 해준다. 단순히 '사막에서 바늘 찾기'를 하는 대신 아래와 같은 질문에 답할 수 있게 해주는 것이다.
* 사막에 바늘이 얼마나 있나?
* 그 바늘의 평균 길이와 중위 길이는?
* 6달동안 사막에 바늘이 얼마나 떨어졌지?

또한 좀 더 아래에 있는 이런 질문들 또한 대답할 수 있을 것이다.
* 가장 인기있는 바늘은 어느 회사의 제품이지?
* 바늘의 특성에 일반적이지 않은 특이한 특성이 있나?

이러한 분석을 통해 실시간으로 데이터를 분석하고 시각화할 수 있으며, 최신의 정보에 기반하여 보고서와 현황판을 업데이트할 수 있을 것이다.

또한 데이터 분석을 자동화하는 데에 있어서 머신러닝 또한 사용 가능하다.